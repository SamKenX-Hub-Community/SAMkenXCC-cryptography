# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# APIsec addresses the critical need to secure APIs before they reach production.
# APIsec provides the industryâ€™s only automated and continuous API testing platform that uncovers security vulnerabilities and logic flaws in APIs.
# Clients rely on APIsec to evaluate every update and release, ensuring that no APIs go to production with vulnerabilities.

# How to Get Started with APIsec.ai
# 1. Schedule a demo at https://www.apisec.ai/request-a-demo .
#
# 2. Register your account at https://cloud.apisec.ai/#/signup .
#
# 3. Register your API . See the video (https://www.youtube.com/watch?v=MK3Xo9Dbvac) to get up and running with APIsec quickly.
#
# 4. Get GitHub Actions scan attributes from APIsec Project -> Configurations -> Integrations -> CI-CD -> GitHub Actions
#
# apisec-run-scan
#
# This action triggers the on-demand scans for projects registered in APIsec.
# If your GitHub account allows code scanning alerts, you can then upload the sarif file generated by this action to show the scan findings.
# Else you can view the scan results from the project home page in APIsec Platform.
# The link to view the scan results is also displayed on the console on successful completion of action.

# This is a starter workflow to help you get started with APIsec-Scan Actions

name: APIsec

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  # Customize trigger events based on your DevSecOps processes.
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '34 10 * * 3'

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:


permissions:
  contents: read

jobs:

  Trigger_APIsec_scan:
    permissions:
      security-events: write # for github/codeql-action/upload-sarif to upload SARIF results
      actions: read # only required for a private repository by github/codeql-action/upload-sarif to get the Action run status
    runs-on: ubuntu-latest

    steps:
       - name: APIsec scan
         uses: apisec-inc/apisec-run-scan@025432089674a28ba8fb55f8ab06c10215e772ea
         with:
          # The APIsec username with which the scans will be executed
          apisec-username: ${{ secrets.apisec_username }}
          # The Password of the APIsec user with which the scans will be executed
          apisec-password: ${{ secrets.apisec_password}}
          # The name of the project for security scan
          apisec-project: "VAmPI"
          # The name of the sarif format result file The file is written only if this property is provided.
          sarif-result-file: "apisec-results.sarif"
       - name: Import results
         uses: github/codeql-action/upload-sarif@v2
         with:
          sarif_file: ./apisec-results.sarif
       - name: Close Stale Issues

  uses: actions/stale@v4.1.1

  with:

    # Token for the repository. Can be passed in using `{{ secrets.GITHUB_TOKEN }}`.

    repo-token: # optional, default is ${{ github.token }}

    # The message to post on the issue when tagging it. If none provided, will not mark issues stale.

    stale-issue-message: # optional

    # The message to post on the pull request when tagging it. If none provided, will not mark pull requests stale.

    stale-pr-message: # optional

    # The message to post on the issue when closing it. If none provided, will not comment when closing an issue.

    close-issue-message: # optional

    # The message to post on the pull request when closing it. If none provided, will not comment when closing a pull requests.

    close-pr-message: # optional

    # The number of days old an issue or a pull request can be before marking it stale. Set to -1 to never mark issues or pull requests as stale automatically.

    days-before-stale: # optional, default is 60

    # The number of days old an issue can be before marking it stale. Set to -1 to never mark issues as stale automatically. Override "days-before-stale" option regarding only the issues.

    days-before-issue-stale: # optional

    # The number of days old a pull request can be before marking it stale. Set to -1 to never mark pull requests as stale automatically. Override "days-before-stale" option regarding only the pull requests.

    days-before-pr-stale: # optional

    # The number of days to wait to close an issue or a pull request after it being marked stale. Set to -1 to never close stale issues or pull requests.

    days-before-close: # optional, default is 7

    # The number of days to wait to close an issue after it being marked stale. Set to -1 to never close stale issues. Override "days-before-close" option regarding only the issues.

    days-before-issue-close: # optional

    # The number of days to wait to close a pull request after it being marked stale. Set to -1 to never close stale pull requests. Override "days-before-close" option regarding only the pull requests.

    days-before-pr-close: # optional

    # The label to apply when an issue is stale.

    stale-issue-label: # optional, default is Stale

    # The label to apply when an issue is closed.

    close-issue-label: # optional

    # The labels that mean an issue is exempt from being marked stale. Separate multiple labels with commas (eg. "label1,label2").

    exempt-issue-labels: # optional, default is 

    # The label to apply when a pull request is stale.

    stale-pr-label: # optional, default is Stale

    # The label to apply when a pull request is closed.

    close-pr-label: # optional

    # The labels that mean a pull request is exempt from being marked as stale. Separate multiple labels with commas (eg. "label1,label2").

    exempt-pr-labels: # optional, default is 

    # The milestones that mean an issue or a pull request is exempt from being marked as stale. Separate multiple milestones with commas (eg. "milestone1,milestone2").

    exempt-milestones: # optional, default is 

    # The milestones that mean an issue is exempt from being marked as stale. Separate multiple milestones with commas (eg. "milestone1,milestone2"). Override "exempt-milestones" option regarding only the issues.

    exempt-issue-milestones: # optional, default is 

    # The milestones that mean a pull request is exempt from being marked as stale. Separate multiple milestones with commas (eg. "milestone1,milestone2"). Override "exempt-milestones" option regarding only the pull requests.

    exempt-pr-milestones: # optional, default is 

    # Exempt all issues and pull requests with milestones from being marked as stale. Default to false.

    exempt-all-milestones: # optional, default is false

    # Exempt all issues with milestones from being marked as stale. Override "exempt-all-milestones" option regarding only the issues.

    exempt-all-issue-milestones: # optional, default is 

    # Exempt all pull requests with milestones from being marked as stale. Override "exempt-all-milestones" option regarding only the pull requests.

    exempt-all-pr-milestones: # optional, default is 

    # Only issues or pull requests with all of these labels are checked if stale. Defaults to `` (disabled) and can be a comma-separated list of labels.

    only-labels: # optional, default is 

    # Only issues or pull requests with at least one of these labels are checked if stale. Defaults to `` (disabled) and can be a comma-separated list of labels.

    any-of-labels: # optional, default is 

    # Only issues with at least one of these labels are checked if stale. Defaults to `` (disabled) and can be a comma-separated list of labels. Override "any-of-labels" option regarding only the issues.

    any-of-issue-labels: # optional, default is 

    # Only pull requests with at least one of these labels are checked if stale. Defaults to `` (disabled) and can be a comma-separated list of labels. Override "any-of-labels" option regarding only the pull requests.

    any-of-pr-labels: # optional, default is 

    # Only issues with all of these labels are checked if stale. Defaults to `[]` (disabled) and can be a comma-separated list of labels. Override "only-labels" option regarding only the issues.

    only-issue-labels: # optional, default is 

    # Only pull requests with all of these labels are checked if stale. Defaults to `[]` (disabled) and can be a comma-separated list of labels. Override "only-labels" option regarding only the pull requests.

    only-pr-labels: # optional, default is 

    # The maximum number of operations per run, used to control rate limiting (GitHub API CRUD related).

    operations-per-run: # optional, default is 30

    # Remove stale labels from issues and pull requests when they are updated or commented on.

    remove-stale-when-updated: # optional, default is true

    # Remove stale labels from issues when they are updated or commented on. Override "remove-stale-when-updated" option regarding only the issues.

    remove-issue-stale-when-updated: # optional, default is 

    # Remove stale labels from pull requests when they are updated or commented on. Override "remove-stale-when-updated" option regarding only the pull requests.

    remove-pr-stale-when-updated: # optional, default is 

    # Run the processor in debug mode without actually performing any operations on live issues.

    debug-only: # optional, default is false

    # The order to get issues or pull requests. Defaults to false, which is descending.

    ascending: # optional, default is false

    # Delete the git branch after closing a stale pull request.

    delete-branch: # optional, default is false

    # The date used to skip the stale action on issue/pull request created before it (ISO 8601 or RFC 2822).

    start-date: # optional, default is 

    # The assignees which exempt an issue or a pull request from being marked as stale. Separate multiple assignees with commas (eg. "user1,user2").

    exempt-assignees: # optional, default is 

    # The assignees which exempt an issue from being marked as stale. Separate multiple assignees with commas (eg. "user1,user2"). Override "exempt-assignees" option regarding only the issues.

    exempt-issue-assignees: # optional, default is 

    # The assignees which exempt a pull request from being marked as stale. Separate multiple assignees with commas (eg. "user1,user2"). Override "exempt-assignees" option regarding only the pull requests.

    exempt-pr-assignees: # optional, default is 

    # Exempt all issues and pull requests with assignees from being marked as stale. Default to false.

    exempt-all-assignees: # optional, default is false

    # Exempt all issues with assignees from being marked as stale. Override "exempt-all-assignees" option regarding only the issues.

    exempt-all-issue-assignees: # optional, default is 

    # Exempt all pull requests with assignees from being marked as stale. Override "exempt-all-assignees" option regarding only the pull requests.

    exempt-all-pr-assignees: # optional, default is 

    # Exempt draft pull requests from being marked as stale. Default to false.

    exempt-draft-pr: # optional, default is false

    # Display some statistics at the end regarding the stale workflow (only when the logs are enabled).

    enable-statistics: # optional, default is true

    # A comma delimited list of labels to add when a stale issue or pull request receives activity and has the stale-issue-label or stale-pr-label removed from it.

    labels-to-add-when-unstale: # optional, default is 

    # A comma delimited list of labels to remove when a stale issue or pull request receives activity and has the stale-issue-label or stale-pr-label removed from it.

    labels-to-remove-when-unstale: # optional, default is 

    # Any update (update/comment) can reset the stale idle time on the issues and pull requests.

    ignore-updates: # optional, default is false

    # Any update (update/comment) can reset the stale idle time on the issues. Override "ignore-updates" option regarding only the issues.

    ignore-issue-updates: # optional, default is 

    # Any update (update/comment) can reset the stale idle time on the pull requests. Override "ignore-updates" option regarding only the pull requests.

    ignore-pr-updates: # optional, default is 
